# Stream Recording Server

Video stream recording dockerized server using python/ffmpeg.

## Usage


### Configuration

Prepare `.env` file, check `.env.example` for the sample.<br>
All possible variables explained below.

```dotenv
# informational
CAM_NAME="Camera 1"

# path where to store the stream recordings
CAM_RECORDINGS_PATH=/data/recordings

# Max capacity size of recording folder in Gigabytes
# for the loop recording, oldest files will be deleted automatically
CAM_RECORDINGS_MAX_SIZE=0.1

# Video stream uri
CAM_VIDEO_STREAM=rtsp://admin:123456@192.168.0.109:554/live/ch0

# Each video file length in seconds
CAM_VIDEO_RECORDING_DURATION=10

# Video file fps
CAM_VIDEO_RECORDING_FPS=30


# Image stream uri
CAM_IMAGE_STREAM=rtsp://admin:123456@192.168.0.109:554/live/ch0

# Image stream interval for the each next shot
CAM_IMAGE_INTERVAL=10

# Image quality
# Possible values from 1 to 31
# 1 - High, 31 - Low
CAM_IMAGE_QUALITY=15
```

To avoid old files deletion (no loop recording), set `CAM_RECORDINGS_MAX_SIZE` to zero `0`<br>
To record videos from stream, provide `CAM_VIDEO_*` variable details.<br>
To record images from stream, provide `CAM_IMAGE_*` variable details.

### How to run

Docker must be installed first!

Run:

```shell
$ docker-compose up
```

Run in detached mode:

```shell
$ docker-compose up -d
```

After successfull start u should see smth like this:<br>

![image](data:image/png;base64,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)